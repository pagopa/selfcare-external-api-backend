meta {
  name: getDocumentByPathEncoded
  type: http
  seq: 12
}

get {
  url: {{apiBaseUrl}}/external/internal/v1/documents/{{documentPath}}
  body: none
  auth: inherit
}

params:path {
  documentPath: {{documentPath}}
}

headers {
  Ocp-Apim-Subscription-Key: {{apimKeyInternal}}
}

script:post-response {
  test("getDocumentByPath encoded ok", function() {
    const status = res.getStatus();
    if (status >= 500) {
      try {
        console.log("[DEBUG] getDocumentByPathEncoded status:", status);
        console.log("[DEBUG] response headers:", JSON.stringify(res.getHeaders()));
        console.log("[DEBUG] response body:", JSON.stringify(res.getBody()));
      } catch (e) {
        console.log("[DEBUG] unable to stringify response for logging", e);
      }
    }

    expect([200, 404, 500]).to.include(status);

    if (status === 200) {
      const data = res.getBody();
      if (Array.isArray(data)) {
        expect(data.length).to.be.greaterThan(0);
      }
    }
  });
}

settings {
  encodeUrl: true
}
